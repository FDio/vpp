{
  "comments": [
    {
      "key": {
        "uuid": "8c6bd5f6_f801724c",
        "filename": "src/vcl/ldp.c",
        "patchSetId": 2
      },
      "lineNbr": 1112,
      "author": {
        "id": 193
      },
      "writtenOn": "2020-09-09T14:48:49Z",
      "side": 1,
      "message": "What I was trying to avoid is keeping state both within vcl and linux kernel for a socket. So when vls_kernel_lh_supported () and the address is localhost, avoid creating a vls session and only create a linux fd. That should completely avoid changing the rest of ldp, vls and vcl.",
      "range": {
        "startLine": 1112,
        "startChar": 3,
        "endLine": 1112,
        "endChar": 34
      },
      "revId": "3829c812f0475370217a5b71039b36723a8c2a31",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0663ed9c_1377873e",
        "filename": "src/vcl/ldp.c",
        "patchSetId": 2
      },
      "lineNbr": 1112,
      "author": {
        "id": 2035
      },
      "writtenOn": "2020-09-10T01:41:48Z",
      "side": 1,
      "message": "When application call socket(), we can\u0027t expect what address will use in bind() or connect(), maybe localhost and maybe another.",
      "parentUuid": "8c6bd5f6_f801724c",
      "range": {
        "startLine": 1112,
        "startChar": 3,
        "endLine": 1112,
        "endChar": 34
      },
      "revId": "3829c812f0475370217a5b71039b36723a8c2a31",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e2764e2c_444edcf2",
        "filename": "src/vcl/ldp.c",
        "patchSetId": 2
      },
      "lineNbr": 1112,
      "author": {
        "id": 193
      },
      "writtenOn": "2020-09-10T02:15:27Z",
      "side": 1,
      "message": "Fair enough, but this is really a lot of complexity added to all ldp apis, and which trickles down into vcl, for a corner case. If possible, I\u0027d like to look for alternatives. \n\nOne idea would be to create the vcl session but once we detect the connect/bind is to localhost (and if the feature is enabled), we allocate a linux fd, add the two to an ldp worker hash table, and then after ldp_fd_to_vlsh do something like:\n\nif (PREDICT_FALSE (ldp_no_lh_sockets ())) \n  ldp_maybe_update_fd_vlsh (\u0026fd, \u0026vlsh);\n\nAnd ldp_maybe_update_fd_vlsh will set vlsh to invalid and fd to the actual linux fd if one was configured. That will force execution of linux apis and keep all of this local to ldp.\n\nThis could probably even be integrated directly into ldp_fd_to_vlsh, with some changes.",
      "parentUuid": "0663ed9c_1377873e",
      "range": {
        "startLine": 1112,
        "startChar": 3,
        "endLine": 1112,
        "endChar": 34
      },
      "revId": "3829c812f0475370217a5b71039b36723a8c2a31",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d1bdbd88_5d4e63a8",
        "filename": "src/vcl/ldp.c",
        "patchSetId": 2
      },
      "lineNbr": 1112,
      "author": {
        "id": 2035
      },
      "writtenOn": "2020-09-10T02:30:29Z",
      "side": 1,
      "message": "Good idea!\nThere is still one problem to slove, that is, after app call socket(), it may call fcntl/setsockopt, and then call bind/connect, if we only create vcl session before, then we need to synchonize sockopts to linux fd. But till now, we may lose some sockopts in vcl session.",
      "parentUuid": "e2764e2c_444edcf2",
      "range": {
        "startLine": 1112,
        "startChar": 3,
        "endLine": 1112,
        "endChar": 34
      },
      "revId": "3829c812f0475370217a5b71039b36723a8c2a31",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4a2668e1_42d1fae3",
        "filename": "src/vcl/ldp.c",
        "patchSetId": 2
      },
      "lineNbr": 1112,
      "author": {
        "id": 193
      },
      "writtenOn": "2020-09-10T02:53:04Z",
      "side": 1,
      "message": "I would go with the synchronization option and update vcl to make sure that all options are stored.",
      "parentUuid": "d1bdbd88_5d4e63a8",
      "range": {
        "startLine": 1112,
        "startChar": 3,
        "endLine": 1112,
        "endChar": 34
      },
      "revId": "3829c812f0475370217a5b71039b36723a8c2a31",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "da6c0b20_17efad8e",
        "filename": "src/vcl/ldp.c",
        "patchSetId": 2
      },
      "lineNbr": 1112,
      "author": {
        "id": 2035
      },
      "writtenOn": "2021-01-27T09:11:30Z",
      "side": 1,
      "message": "Hi, I want to know how it is going.",
      "parentUuid": "4a2668e1_42d1fae3",
      "range": {
        "startLine": 1112,
        "startChar": 3,
        "endLine": 1112,
        "endChar": 34
      },
      "revId": "3829c812f0475370217a5b71039b36723a8c2a31",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    }
  ]
}