{
  "comments": [
    {
      "key": {
        "uuid": "d68c4dd5_02ce8a3f",
        "filename": "src/vnet/tcp/tcp_input.c",
        "patchSetId": 2
      },
      "lineNbr": 2632,
      "author": {
        "id": 193
      },
      "writtenOn": "2021-10-19T15:10:02Z",
      "side": 1,
      "message": "Can we randomize this? Maybe something like \n`(uword)(tcp_time_now_us (tc-\u003ec_thread_index) * 1e6) % 65535`.",
      "range": {
        "startLine": 2632,
        "startChar": 28,
        "endLine": 2632,
        "endChar": 38
      },
      "revId": "096ff2d197318eff62b3533d72e8c714c4922a32",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "782af167_517cab5b",
        "filename": "src/vnet/tcp/tcp_input.c",
        "patchSetId": 2
      },
      "lineNbr": 2632,
      "author": {
        "id": 2576
      },
      "writtenOn": "2021-10-19T18:11:55Z",
      "side": 1,
      "message": "we need to make sure that the iss is larger than the largest sequence number it used on the previous connection, I think randomizing this wouldn\u0027t guarantee this. We could make it larger like tc-\u003esnd_nxt + 65535 + (uword)(tcp_time_now_us (tc-\u003ec_thread_index) * 1e6) % 65535\nmake sense?",
      "parentUuid": "d68c4dd5_02ce8a3f",
      "range": {
        "startLine": 2632,
        "startChar": 28,
        "endLine": 2632,
        "endChar": 38
      },
      "revId": "096ff2d197318eff62b3533d72e8c714c4922a32",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cced6179_48393283",
        "filename": "src/vnet/tcp/tcp_input.c",
        "patchSetId": 2
      },
      "lineNbr": 2632,
      "author": {
        "id": 193
      },
      "writtenOn": "2021-10-19T19:35:28Z",
      "side": 1,
      "message": "Since the connection is in timewait, tc-\u003esnd_nxt should be the largest sequence number used, i.e., we never move it backwards. But if we really want to make sure, tc-\u003esnd_nxt + tcp_available_snd_wnd (tc) + reasonable_rand_number should be okay, I guess. Am I missing something about 65535?",
      "parentUuid": "782af167_517cab5b",
      "range": {
        "startLine": 2632,
        "startChar": 28,
        "endLine": 2632,
        "endChar": 38
      },
      "revId": "096ff2d197318eff62b3533d72e8c714c4922a32",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "40335926_8b986093",
        "filename": "src/vnet/tcp/tcp_input.c",
        "patchSetId": 2
      },
      "lineNbr": 2632,
      "author": {
        "id": 2576
      },
      "writtenOn": "2021-10-20T08:03:35Z",
      "side": 1,
      "message": "I think your proposal for snd_nxt + available_snd_wnd is more accurate. I took the 65535 from linux kernel code, I assumed that snd_nxt + 64K is the maximum sequence number the peer-connection will be willing to accept. However, the available_snd_wnd is more accurate. Will modify accordingly. Thanks!",
      "parentUuid": "cced6179_48393283",
      "range": {
        "startLine": 2632,
        "startChar": 28,
        "endLine": 2632,
        "endChar": 38
      },
      "revId": "096ff2d197318eff62b3533d72e8c714c4922a32",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4c2933d1_494ed7c7",
        "filename": "src/vnet/tcp/tcp_input.c",
        "patchSetId": 2
      },
      "lineNbr": 2639,
      "author": {
        "id": 193
      },
      "writtenOn": "2021-10-18T16:33:26Z",
      "side": 1,
      "message": "Maybe return 1 on this branch and 0 on the other? That is, use it as \"if syn during timewait, do something\".",
      "range": {
        "startLine": 2639,
        "startChar": 13,
        "endLine": 2639,
        "endChar": 14
      },
      "revId": "096ff2d197318eff62b3533d72e8c714c4922a32",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e368eae4_10226b08",
        "filename": "src/vnet/tcp/tcp_input.c",
        "patchSetId": 2
      },
      "lineNbr": 2639,
      "author": {
        "id": 2576
      },
      "writtenOn": "2021-10-19T11:53:39Z",
      "side": 1,
      "message": "sure. makes sense.",
      "parentUuid": "4c2933d1_494ed7c7",
      "range": {
        "startLine": 2639,
        "startChar": 13,
        "endLine": 2639,
        "endChar": 14
      },
      "revId": "096ff2d197318eff62b3533d72e8c714c4922a32",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b44e385e_91437994",
        "filename": "src/vnet/tcp/tcp_input.c",
        "patchSetId": 2
      },
      "lineNbr": 2643,
      "author": {
        "id": 193
      },
      "writtenOn": "2021-10-19T15:10:02Z",
      "side": 1,
      "message": "TCP_DBG(), as it can otherwise be exploited. If we really want to keep track of this, we could add it to the worker stats (see tcp_wrk_stats_t).",
      "range": {
        "startLine": 2643,
        "startChar": 6,
        "endLine": 2643,
        "endChar": 18
      },
      "revId": "096ff2d197318eff62b3533d72e8c714c4922a32",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "24b00df7_74b7dc43",
        "filename": "src/vnet/tcp/tcp_input.c",
        "patchSetId": 2
      },
      "lineNbr": 2643,
      "author": {
        "id": 2576
      },
      "writtenOn": "2021-10-19T18:11:55Z",
      "side": 1,
      "message": "ok, will take a look.",
      "parentUuid": "b44e385e_91437994",
      "range": {
        "startLine": 2643,
        "startChar": 6,
        "endLine": 2643,
        "endChar": 18
      },
      "revId": "096ff2d197318eff62b3533d72e8c714c4922a32",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fd2b848c_a2a4a58f",
        "filename": "src/vnet/tcp/tcp_input.c",
        "patchSetId": 2
      },
      "lineNbr": 2643,
      "author": {
        "id": 193
      },
      "writtenOn": "2021-10-19T19:35:28Z",
      "side": 1,
      "message": "Thanks! Feel free to reach out if something\u0027s not clear.",
      "parentUuid": "24b00df7_74b7dc43",
      "range": {
        "startLine": 2643,
        "startChar": 6,
        "endLine": 2643,
        "endChar": 18
      },
      "revId": "096ff2d197318eff62b3533d72e8c714c4922a32",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    }
  ]
}