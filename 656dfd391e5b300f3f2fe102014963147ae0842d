{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "26387849_9c4aeab9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1849
      },
      "writtenOn": "2023-01-10T09:21:51Z",
      "side": 1,
      "message": "Hi Dastin,\n\nCan you share\n1. Did the patch resolved SPR NDR rate drop problem?\n2. What is the perf impact to QAT GEN2/3?\n\nAlso a nit, it would be better if you can explain the issue in SPR QAT in the commit message.\n\nRegards,\nFan",
      "revId": "656dfd391e5b300f3f2fe102014963147ae0842d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fae459bd_463878a5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 2589
      },
      "writtenOn": "2023-01-10T10:18:38Z",
      "side": 1,
      "message": "Unfortunately we have an issue on SPR with this patch, this is why I added you to the review, on QAT GEN2/3 it works fine and perf impact was very small, I could only test on my board with small packet size (high packet rate) and perf was comparable to master what\u0027s more enc/dec distribution was even for 64 burst size (tested for 32 but for high packet rate I was getting very uneven enc/dec distribution on GEN2/3)\n\nCurrent issue is such we get nothing dequeued on decryption node on SPR platform, on GEN2/3 it worked fine, current testing setup consists of SPR platform with NICs connected with each other and IXIA, when we try to decrypt traffic on 2nd node (regardless on which we are encrypting) dequeue burst returns nothing, rings gets filled, buffers get exhausted and all incoming traffic gets rx-no-buf.",
      "parentUuid": "26387849_9c4aeab9",
      "revId": "656dfd391e5b300f3f2fe102014963147ae0842d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b374d854_0fe52a40",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1849
      },
      "writtenOn": "2023-01-10T10:24:32Z",
      "side": 1,
      "message": "Did you try with op data path, the same?",
      "parentUuid": "fae459bd_463878a5",
      "revId": "656dfd391e5b300f3f2fe102014963147ae0842d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a431c973_3f1d1b1e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 2589
      },
      "writtenOn": "2023-01-10T11:25:00Z",
      "side": 1,
      "message": "Didn\u0027t try, patch only modifies raw data path (changes for op data path are only to accommodate changes in structures), master for raw data path works fine on SPR except NDR issue. I thought maybe reversing change in such a way that one worker will only use one QAT queue as on master would do the trick?",
      "parentUuid": "b374d854_0fe52a40",
      "revId": "656dfd391e5b300f3f2fe102014963147ae0842d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "06403822_85483930",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 2589
      },
      "writtenOn": "2023-01-13T12:51:37Z",
      "side": 1,
      "message": "I\u0027ve uploaded new patchset, I\u0027ve reversed change where single worker owned more that one cryptodev instance and readjusted code to not divide enc/dec. This seems to make patch functional and I have not observed any drops originating from QAT on SPR, perf seems to be not impacted, more testing needed.\nThere is a question though, why there was an issue when single worker tried to divide work between two cryptodev instances (as seen in show cryptodev assignment), this issue was not occurring on GEN3 while for GEN4 packet on decryption instance got stuck in the queue and attempt to dequeu it was always resulting in empty response from QAT.",
      "parentUuid": "a431c973_3f1d1b1e",
      "revId": "656dfd391e5b300f3f2fe102014963147ae0842d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    }
  ]
}