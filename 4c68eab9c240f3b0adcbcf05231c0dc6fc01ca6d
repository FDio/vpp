{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "80f43715_b4dca969",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 2936
      },
      "writtenOn": "2023-08-07T02:49:01Z",
      "side": 1,
      "message": "Let\u0027s see if anyone else comments...",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f68f486d_ab6a6ff4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 2936
      },
      "writtenOn": "2023-08-11T01:19:09Z",
      "side": 1,
      "message": "Helloï¼ŒPlease give a review if you have time",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "532e12d0_a1f494af",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 8
      },
      "writtenOn": "2023-09-06T08:28:48Z",
      "side": 1,
      "message": "Dear Yanglong,\nApologies for the delay.\n\nUnder what circumstances do you see that assert being triggered?\nE.g. if the initial packet has a wrong checksum, or perhaps you set the checksum to 0 because you wanted checksum offload?\n\nOne alternative could be to remove that assert. Depending.",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "725034ab_fc336c75",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 2936
      },
      "writtenOn": "2023-10-08T08:36:27Z",
      "side": 1,
      "message": "Problem scenarios:\nUse vpp\u0027s vcl to set up nginx as a transparent proxy, that is, change the destination ip to the bvi0 ip in vpp by configuring pnat rules, and then the above Assert problem will occur.\n\n\nPc1(7.7.7.6) \u003d\u003d\u003e  vpp(192.168.102.1) \u003d\u003d\u003d\u003evcl nginx(10001) \u003d\u003d\u003d\u003ePc2(7.7.7.7:15001)\nDo pnat for the traffic from pc1 to pc2 to nginx. \n\n-----------------------------------------------------------\nvpp configuration:\n\ncreate host-interface name  vpp1outside\nset interface state host-vpp1outside up\nset interface ip address host-vpp1outside 192.168.102.1/24\n\nset pnat translation interface host-vpp1outside match  dst 7.7.7.7 dport 15001 proto tcp rewrite dst 192.168.102.1 dport 10001 in\n\nset pnat translation interface host-vpp1outside match  src 192.168.102.1 sport 10001 proto tcp rewrite src 7.7.7.7 sport 15001 out",
      "parentUuid": "532e12d0_a1f494af",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "486a26f4_08a43328",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 8
      },
      "writtenOn": "2023-10-16T09:55:02Z",
      "side": 1,
      "message": "Thanks! What is the use case where the ip checksum is zero?\nIs it a real packet that has the wrong checksum?\nOr is it PNAT incremental checksum that gets it wrong?\nThe assert is a left-over from when developing it, it\u0027s possible to just remove the assert (is disabled in release image anyway).",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "68a7dda9_3b9c976e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 8
      },
      "writtenOn": "2023-10-16T09:58:31Z",
      "side": 1,
      "message": "Hi Florin, PNAT getting IP checksum \u003d\u003d 0 packets from VCL.\nI guess that\u0027s expected. Checksum offload?\nWhat should PNAT do... check offload flags, and do not do incremental checksum?",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dc5c41d3_68326694",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 8
      },
      "writtenOn": "2023-10-16T09:58:31Z",
      "side": 1,
      "message": "My apologies. I didn\u0027t see your comment above before replying.\nSo... is the case here that the checksum is not set yet? I.e. assumes checksum offload? In that case, PNAT should probably not incrementally update the IP checksum (it would be handled later).",
      "parentUuid": "486a26f4_08a43328",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4b5ed123_8eba4b49",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 193
      },
      "writtenOn": "2023-10-16T16:20:16Z",
      "side": 1,
      "message": "Yup, if csum offload flag is on, no action. \n\n@yanlong, I suspect you already know this but just for completeness, a suboptimal solution to this would be to disable tcp csum offloading by adding to vpp\u0027s startup.conf `tcp { no-csum-offload }`",
      "parentUuid": "68a7dda9_3b9c976e",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c9859477_5ed9f88f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 2936
      },
      "writtenOn": "2023-10-17T02:47:55Z",
      "side": 1,
      "message": "done",
      "parentUuid": "dc5c41d3_68326694",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4889d47c_db7e27bb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 2936
      },
      "writtenOn": "2023-10-17T02:47:55Z",
      "side": 1,
      "message": "okay, thank you\n\nokay, thank you\n\nThat is to say, all messages interacting with vcl can only go through checksum hardware uninstallation, right? Just need to set \"tcp { no-csum-offload }\"\n@Florin Coras  @Ole Troan",
      "parentUuid": "4b5ed123_8eba4b49",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "022773a2_2936d435",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 193
      },
      "writtenOn": "2023-10-17T15:50:27Z",
      "side": 1,
      "message": "Yes. If no-csum-offload is configured, tcp layer computes the checksum for all packets as opposed to offloading computation to underlying hw.",
      "parentUuid": "4889d47c_db7e27bb",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "80e4edd1_8abfc180",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 2936
      },
      "writtenOn": "2023-10-18T02:26:51Z",
      "side": 1,
      "message": "Hello expert, I have a question. Is the design of strong binding between VCL and hardware checksum uninstallation unreasonable? I believe that using VCL does not necessarily mean that users must use hardware uninstallation, which is a bit strong binding.\n\nIs it reasonable to add a software assignment of checksum to the package sent by VCL by default? If the user sets \"TCP {no sum offload}\", they will proceed with hardware uninstallation. If not set, they will proceed with software assignment and verification @Florin Coras",
      "parentUuid": "022773a2_2936d435",
      "revId": "4c68eab9c240f3b0adcbcf05231c0dc6fc01ca6d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    }
  ]
}