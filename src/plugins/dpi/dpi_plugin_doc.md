# DPI plugin for VPP    {#dpi_plugin_doc}

## Overview

DPI plugin can identify and analyze the traffic running on networks in real time.
It can be used on many use cases, such as Web Application Firewall,
Policy based routing, Intrusion Detection System, Intrusion Prevention System, etc.

Here are some possbile use cases:
1). Web Application Firewall
A Web Application Firewall filters, monitors, and blocks HTTP traffic
to and from a web application. By inspecting HTTP traffic, it can
prevent attacks stemming from web application security flaws, such as SQL injection,
cross-site scripting, file inclusion, and security misconfigurations.

2). Policy based routing
It can identify application level flows, and prioritize mission-critical applications
in case of bandwidth limitations, then these applications can be dynamically routed
with the suitable fastest path.

## Design

The DPI plugin leverage Hyperscan to perform regex matching.

Hyperscan is a high-performance multiple regex matching library.
Please refer to below for details:
http://intel.github.io/dpi/dev-reference/

This plugin provides Hyperscan support on VPP, so can implement DPI/IPS/IDS etc.

## Hyperscan Installation

Hyperscan can be installed from packages directly on below OS:
  Ubuntu 16.04.03
  Ubuntu 18.04 and later version
  Fedora 27 and later version
  openSUSE rolling-release Tumbleweed and later version

If you cannot install Hyperscan from packages directly,
you can build and install it from the source code.

Below are steps to build and install Hyperscan on Ubuntu 16.04:
1).Install binary prerequisites
apt-get install cmake ragel
apt-get install libboost-dev
apt-get install python-dev libbz2-dev

2).Download Hyperscan sources
wget https://github.com/intel/hyperscan/archive/v5.0.0.tar.gz
tar -xf v5.0.0.tar.gz

3).Download boost headers
wget https://dl.bintray.com/boostorg/release/1.68.0/source/boost_1_68_0.tar.gz
tar -xf boost_1_68_0.tar.gz
cp -r boost_1_68_0/boost hyperscan-5.0.0/include

4).Build and install Hyperscan shared library.
   Just follow the instruction from here. Compilation can take a long time.
cd hyperscan-5.0.0
mkdir build
cd build
cmake -DBUILD_SHARED_LIBS=true ..
make
make install


## Configuration

### Configure ip_dpi_bypass

The dpi plugin need to redirct packets to dpi-scan graph node:

    dpi set interface ip4 dpi-bypass <interface> [del]

interface: the interface that you want to enable dpi.


### Configure and compile Hyperscan

The dpi plugin need to configure regular matching patterns
and compile them into database.

    dpi compile mode [block|stream] flags [imsHV8W\r] \
               patterns <patterns> action [permit|drop]

mode: Compiler mode.
      HS_MODE_BLOCK or HS_MODE_STREAM or HS_MODE_VECTORED must be supplied.
flags: Flags which modify the behaviour of the expression.
       Multiple flags may be used by ORing them together.
patterns: The NULL-terminated expression to parse

For example:
To block all HTTP traffic in Web Application Firewall, configure as below:

  dpi compile mode block flags is patterns HTTP action drop

## Multi-Thread Support
Since generated bytecode database is read only, you can run multiple cores
to utilize the byte database to scale.




