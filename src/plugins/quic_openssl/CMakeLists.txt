# SPDX-License-Identifier: Apache-2.0
# Copyright (c) 2025 Cisco

if(NOT OPENSSL_FOUND)
  message(WARNING "quic_openssl plugin disabled - OpenSSL not found")
  return()
endif()

set(EXPECTED_OPENSSL_VERSION "3.5.0")

if(OPENSSL_FOUND AND OPENSSL_VERSION VERSION_GREATER_EQUAL ${EXPECTED_OPENSSL_VERSION})
  include_directories (${OPENSSL_INCLUDE_DIR})

  add_vpp_plugin(quic_openssl
    SOURCES
    quic_openssl.c
    quic_openssl_crypto.c

    LINK_LIBRARIES ${OPENSSL_LIBRARIES}
  )
  message(STATUS "quic_openssl plugin needs OpenSSL version >= \"${EXPECTED_OPENSSL_VERSION}\" - found OpenSSL \"${OPENSSL_VERSION}\" in ${OPENSSL_INCLUDE_DIR}")
else()
  message(STATUS "quic_openssl plugin disabled - invalid OpenSSL version: \"${OPENSSL_VERSION}\" < \"${EXPECTED_OPENSSL_VERSION}\" ")
endif()
