{
  "comments": [
    {
      "key": {
        "uuid": "fbf599ea_9283d0ff",
        "filename": "src/plugins/perfmon/arm/bundle/branch_pred.c",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 540
      },
      "writtenOn": "2021-09-01T15:52:57Z",
      "side": 1,
      "message": "perhaps instead of all the verbosity of checking b-\u003eevent_enabled every time, we could just sure that calls to disabled events never make it as far as format_xyz?",
      "range": {
        "startLine": 22,
        "startChar": 0,
        "endLine": 22,
        "endChar": 22
      },
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0514ec74_b4a26e22",
        "filename": "src/plugins/perfmon/arm/bundle/branch_pred.c",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 2465
      },
      "writtenOn": "2021-09-02T08:04:36Z",
      "side": 1,
      "message": "I\u0027m not sure how to make this work since the column headers are fixed, and dynamically generating this kind of formatting info becomes difficult. It is verbose, but I haven\u0027t been able to think of a better way to do it.",
      "parentUuid": "fbf599ea_9283d0ff",
      "range": {
        "startLine": 22,
        "startChar": 0,
        "endLine": 22,
        "endChar": 22
      },
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c0bde515_6f6224f2",
        "filename": "src/plugins/perfmon/arm/bundle/branch_pred.c",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 540
      },
      "writtenOn": "2021-09-02T16:06:58Z",
      "side": 1,
      "message": "Isn\u0027t it just a matter of maintaining a bitmap of what fields are enabled in each bundle, and then checking the bit before dispatching to format_xyz?",
      "parentUuid": "0514ec74_b4a26e22",
      "range": {
        "startLine": 22,
        "startChar": 0,
        "endLine": 22,
        "endChar": 22
      },
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a52462b3_fd8dbafd",
        "filename": "src/plugins/perfmon/arm/bundle/branch_pred.c",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 2465
      },
      "writtenOn": "2021-09-06T14:20:27Z",
      "side": 1,
      "message": "Ah right - yep, I understand. I think we can make the check in table.c:table_format_cell(), which calls the bundle-\u003eformat_fn. This would clean up this code a lot.",
      "parentUuid": "c0bde515_6f6224f2",
      "range": {
        "startLine": 22,
        "startChar": 0,
        "endLine": 22,
        "endChar": 22
      },
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8232c0ce_1407e630",
        "filename": "src/plugins/perfmon/arm/dispatch_wrapper.c",
        "patchSetId": 1
      },
      "lineNbr": 103,
      "author": {
        "id": 540
      },
      "writtenOn": "2021-09-01T15:52:57Z",
      "side": 1,
      "message": "this is very close to how the intel perfmon_dispatch_wrapper_mmap works right, \nwith small differences to how the mmap is ready. \nwe should try to make as much of the code common as possible?",
      "range": {
        "startLine": 103,
        "startChar": 0,
        "endLine": 103,
        "endChar": 25
      },
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "25d8477a_8d666ebf",
        "filename": "src/plugins/perfmon/arm/dispatch_wrapper.c",
        "patchSetId": 1
      },
      "lineNbr": 103,
      "author": {
        "id": 2465
      },
      "writtenOn": "2021-09-02T08:04:36Z",
      "side": 1,
      "message": "You\u0027re right, this function is basically identical to Intel\u0027s perfmon_dispatch_wrapper_mmap() so maybe we can extract this to a common file and keep x86/Arm specific stuff in separate files? \n\nSince the patch changing how x86 reads (https://gerrit.fd.io/r/c/vpp/+/33380), x86 and Arm and definitely more aligned but there still a lot of arch specific stuff. I think separate files over lots of \"#if defined(__\u003caarch\u003e__) blocks is preferred if possible.",
      "parentUuid": "8232c0ce_1407e630",
      "range": {
        "startLine": 103,
        "startChar": 0,
        "endLine": 103,
        "endChar": 25
      },
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "25711cc1_55dd85fc",
        "filename": "src/plugins/perfmon/arm/dispatch_wrapper.c",
        "patchSetId": 1
      },
      "lineNbr": 103,
      "author": {
        "id": 540
      },
      "writtenOn": "2021-09-02T16:06:58Z",
      "side": 1,
      "message": "I don\u0027t see that we would lots of #ifdef\u0027s though, we should be able to keep it to just one.",
      "parentUuid": "25d8477a_8d666ebf",
      "range": {
        "startLine": 103,
        "startChar": 0,
        "endLine": 103,
        "endChar": 25
      },
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9ba46b26_b381f019",
        "filename": "src/plugins/perfmon/arm/dispatch_wrapper.c",
        "patchSetId": 1
      },
      "lineNbr": 103,
      "author": {
        "id": 2465
      },
      "writtenOn": "2021-09-06T14:20:27Z",
      "side": 1,
      "message": "It\u0027s possible, but then we would still have a mix of Arm/Intel functions in a single file? I think it would be cleaner to keep the Arm/Intel specific code separate in the /arm + /intel directories.",
      "parentUuid": "25711cc1_55dd85fc",
      "range": {
        "startLine": 103,
        "startChar": 0,
        "endLine": 103,
        "endChar": 25
      },
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4d2e8231_4a165eef",
        "filename": "src/plugins/perfmon/cli.c",
        "patchSetId": 1
      },
      "lineNbr": 331,
      "author": {
        "id": 540
      },
      "writtenOn": "2021-09-01T15:52:57Z",
      "side": 1,
      "message": "please use /* */",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ccceb3ae_2d238c27",
        "filename": "src/plugins/perfmon/cli.c",
        "patchSetId": 1
      },
      "lineNbr": 331,
      "author": {
        "id": 2465
      },
      "writtenOn": "2021-09-02T08:04:36Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "4d2e8231_4a165eef",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f4808a70_a892b75f",
        "filename": "src/plugins/perfmon/perfmon.c",
        "patchSetId": 1
      },
      "lineNbr": 152,
      "author": {
        "id": 540
      },
      "writtenOn": "2021-09-01T15:52:57Z",
      "side": 1,
      "message": "do we need a warning? better to just silently fail?",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fc60c764_5ad7255e",
        "filename": "src/plugins/perfmon/perfmon.c",
        "patchSetId": 1
      },
      "lineNbr": 152,
      "author": {
        "id": 2465
      },
      "writtenOn": "2021-09-02T08:04:36Z",
      "side": 1,
      "message": "I think we could silently fail instead. I was originally thinking from a user perspective it might help explain why certain events in the output show up as \u0027-\u0027. Maybe that\u0027s implicit.",
      "parentUuid": "f4808a70_a892b75f",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b6e4fae8_d9ca4d4c",
        "filename": "src/plugins/perfmon/perfmon.h",
        "patchSetId": 1
      },
      "lineNbr": 30,
      "author": {
        "id": 540
      },
      "writtenOn": "2021-09-01T15:52:57Z",
      "side": 1,
      "message": "I suspect we are going to need a mechanism for making this cpu specific.",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "de4f9a41_e294aebc",
        "filename": "src/plugins/perfmon/perfmon.h",
        "patchSetId": 1
      },
      "lineNbr": 30,
      "author": {
        "id": 2465
      },
      "writtenOn": "2021-09-02T08:04:36Z",
      "side": 1,
      "message": "Probably. I think in theory it\u0027s possible some Arm CPUs may have less than this, but I need to do some digging. In practice 6 event + 1 cycle seems common.",
      "parentUuid": "b6e4fae8_d9ca4d4c",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "051209db_094a0717",
        "filename": "src/plugins/perfmon/perfmon.h",
        "patchSetId": 1
      },
      "lineNbr": 119,
      "author": {
        "id": 540
      },
      "writtenOn": "2021-09-01T15:52:57Z",
      "side": 1,
      "message": "would this be more robust as bitmask?",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b1348df1_710ea066",
        "filename": "src/plugins/perfmon/perfmon.h",
        "patchSetId": 1
      },
      "lineNbr": 119,
      "author": {
        "id": 2465
      },
      "writtenOn": "2021-09-02T08:04:36Z",
      "side": 1,
      "message": "Can you give an example how this would work?\n\nWe are checking if n_events \u003d\u003d n_events_implemented in cli.c to figure out if we need to fix formatting/alignment or not.\n\nI considered event_enabled[PERF_MAX_EVENTS] as a bitmap but that seems overkill.",
      "parentUuid": "051209db_094a0717",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9c8a61da_40efe13d",
        "filename": "src/plugins/perfmon/perfmon.h",
        "patchSetId": 1
      },
      "lineNbr": 119,
      "author": {
        "id": 540
      },
      "writtenOn": "2021-09-02T16:06:58Z",
      "side": 1,
      "message": "n_events_implemented seems to be a counter right, \nSo if n_events_implemented !\u003d n_events, you know that some events are disabled.\nI was just pointing out ... it would be more obvious to indicate which events are enabled and disabled with a bitmaps.\n\nSo that ....\n\nIf there where a total of 4 events and if event[1] was disable.\nThere would be a bit mask of 0xC (i.e. 1101) - easy to check, easy to understand. \n\nThe alternative would be to just remove disabled events from events[]",
      "parentUuid": "b1348df1_710ea066",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bc38b683_24bf8d51",
        "filename": "src/plugins/perfmon/perfmon.h",
        "patchSetId": 1
      },
      "lineNbr": 119,
      "author": {
        "id": 2465
      },
      "writtenOn": "2021-09-06T14:20:27Z",
      "side": 1,
      "message": "That is how event_enabled[PERF_MAX_EVENTS] is operating, albeit with (slightly) more memory. You\u0027re right a bitmask to go on top of events[PERF_MAX_EVENTS] would probably nicer overall.\n\nShould be easy to do with clib_bitmap_alloc(), clib_bitmap_set/get(). I\u0027ll add it to the list of improvements.\n\nI think if we can remove the if !b-\u003eevent_enabled[x] checks in all bundles as per your previous comment, then that will overall clean things up nicely.\n\nI haven\u0027t fully checked, but I suspect removing disabled items from events[] would mess up the alignment since column headers are not dynamic. There would be a fair bit of extra work to dynamically display column headers since we\u0027d need to check which events are used under each header somehow.",
      "parentUuid": "9c8a61da_40efe13d",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f2eeaf93_5ed4af91",
        "filename": "src/plugins/perfmon/perfmon.h",
        "patchSetId": 1
      },
      "lineNbr": 126,
      "author": {
        "id": 540
      },
      "writtenOn": "2021-09-01T15:52:57Z",
      "side": 1,
      "message": "avoid formatting changes",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c6e49bfc_1b652bab",
        "filename": "src/plugins/perfmon/perfmon.h",
        "patchSetId": 1
      },
      "lineNbr": 126,
      "author": {
        "id": 2465
      },
      "writtenOn": "2021-09-02T08:04:36Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "f2eeaf93_5ed4af91",
      "revId": "237d5d069e0426ef068bf6482217a3cbbc8971ae",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    }
  ]
}