{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "39899063_2699c3e0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 361
      },
      "writtenOn": "2022-08-24T11:51:15Z",
      "side": 1,
      "message": "Out if curiosity, in which scenario do you have network interfaces with 0 rxq?",
      "revId": "bae3444755dcdbe3cbb5fb8ef72389129d91f1e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1968e955_2172f717",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 2785
      },
      "writtenOn": "2022-08-25T01:48:08Z",
      "side": 1,
      "message": "I create a virtio interface and use linux_cp_plugin create a tap interface base it. While I set tap interface rx-mode as interrupt and try to delete it, it cause this.",
      "parentUuid": "39899063_2699c3e0",
      "revId": "bae3444755dcdbe3cbb5fb8ef72389129d91f1e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5a2cb0fa_50af0455",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1698
      },
      "writtenOn": "2022-09-05T08:49:46Z",
      "side": 1,
      "message": "Hi GaoChX\n\nDoes this fix come from a stacktrace you observed ?\nJust to know if this is isn\u0027t caused by another issue.\n\nCheers",
      "revId": "bae3444755dcdbe3cbb5fb8ef72389129d91f1e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "95151f9b_256ddcf9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 2785
      },
      "writtenOn": "2022-09-07T03:48:42Z",
      "side": 1,
      "message": "Hi Nathan\n\nYes, I fixed it form stacktrace. Here is the backtrace:\n\n(gdb) bt\n#0  0x00007f4bad2e837f in raise () from /lib64/libc.so.6\n#1  0x00007f4bad2d2db5 in abort () from /lib64/libc.so.6\n#2  0x0000000000406024 in os_exit (code\u003dcode@entry\u003d1) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vpp/vnet/main.c:440\n#3  0x00007f4bae585bf1 in unix_signal_handler (signum\u003d11, si\u003d\u003coptimized out\u003e, uc\u003d\u003coptimized out\u003e) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vlib/unix/main.c:188\n#4  \u003csignal handler called\u003e\n#5  vnet_hw_if_rx_queue_set_int_pending (queue_index\u003d14, vnm\u003d0x7f4bafd8dce0 \u003cvnet_main\u003e) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vnet/interface/rx_queue_funcs.h:55\n#6  vnet_hw_if_update_runtime_data (vnm\u003dvnm@entry\u003d0x7f4bafd8dce0 \u003cvnet_main\u003e, hw_if_index\u003dhw_if_index@entry\u003d6)\n    at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vnet/interface/runtime.c:331\n#7  0x00007f4baeb2a404 in vnet_delete_hw_interface (vnm\u003dvnm@entry\u003d0x7f4bafd8dce0 \u003cvnet_main\u003e, hw_if_index\u003dhw_if_index@entry\u003d6)\n    at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vnet/interface.c:1114\n#8  0x00007f4baeb7645c in ethernet_delete_interface (vnm\u003d\u003coptimized out\u003e, hw_if_index\u003d\u003coptimized out\u003e) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vnet/ethernet/interface.c:445\n#9  0x00007f4baf0d02f5 in tap_delete_if (vm\u003d0x7f4b6d2b1700, sw_if_index\u003dsw_if_index@entry\u003d6) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vnet/devices/tap/tap.c:763\n#10 0x00007f4b669c3640 in lcp_itf_pair_delete_by_index (lipi\u003d\u003coptimized out\u003e) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vlib/global_funcs.h:34\n#11 0x00007f4b669c39fc in lcp_itf_pair_delete (phy_sw_if_index\u003d\u003coptimized out\u003e) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/plugins/linux-cp/lcp_interface.c:520\n#12 0x00007f4b66bd9785 in lcp_itf_pair_delete_command_fn (vm\u003d\u003coptimized out\u003e, input\u003d0x7f4b5e10eea0, cmd\u003d\u003coptimized out\u003e)\n    at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/plugins/linux-cp/lcp_cli.c:295\n#13 0x00007f4bae511492 in vlib_cli_dispatch_sub_commands (vm\u003dvm@entry\u003d0x7f4b6d2b1700, input\u003dinput@entry\u003d0x7f4b5e10eea0, parent_command_index\u003d\u003coptimized out\u003e, cm\u003d\u003coptimized out\u003e)\n    at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vlib/cli.c:650\n#14 0x00007f4bae5115ed in vlib_cli_dispatch_sub_commands (vm\u003dvm@entry\u003d0x7f4b6d2b1700, input\u003dinput@entry\u003d0x7f4b5e10eea0, parent_command_index\u003dparent_command_index@entry\u003d0,\n    cm\u003d\u003coptimized out\u003e) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vlib/cli.c:607\n#15 0x00007f4bae511a96 in vlib_cli_input (vm\u003d0x7f4b6d2b1700, input\u003dinput@entry\u003d0x7f4b5e10eea0, function\u003dfunction@entry\u003d0x7f4bae57a860 \u003cunix_vlib_cli_output\u003e,\n    function_arg\u003dfunction_arg@entry\u003d1) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vlib/cli.c:753\n#16 0x00007f4bae57b64c in unix_cli_process_input (cli_file_index\u003d\u003coptimized out\u003e, cm\u003d0x7f4bae8294c0 \u003cunix_cli_main\u003e)\n    at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vlib/unix/cli.c:2617\n#17 0x00007f4bae582a05 in unix_cli_process (vm\u003d\u003coptimized out\u003e, rt\u003d\u003coptimized out\u003e, f\u003d\u003coptimized out\u003e) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vlib/unix/cli.c:2746\n#18 0x00007f4bae529486 in vlib_process_bootstrap (_a\u003d\u003coptimized out\u003e) at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vlib/main.c:1222\n#19 0x00007f4bada8f514 in clib_calljmp () at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vppinfra/longjmp.S:123\n#20 0x00007f4b603dcae0 in ?? ()\n#21 0x00007f4bae52ac8c in dispatch_process (vm\u003d0x7f4b6d2b1700, p\u003d\u003coptimized out\u003e, last_time_stamp\u003d\u003coptimized out\u003e, f\u003d0x0)\n    at /usr/src/debug/vpp-22.06.0-8~g09d316fd6.x86_64/src/vppinfra/types.h:153\n#22 0x0000000000000000 in ?? ()",
      "parentUuid": "5a2cb0fa_50af0455",
      "revId": "bae3444755dcdbe3cbb5fb8ef72389129d91f1e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d1defb16_cfa1d542",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1698
      },
      "writtenOn": "2022-09-07T16:21:21Z",
      "side": 1,
      "message": "Thanks for the backtrace. It seems we are removing the queues and accessing them again when vnet_delete_hw_interface is called with an interrupt pending.\n\ncould you try changing the order of calls in src/vnet/interface.c:1112-1114 to :\n````\n  vnet_hw_if_update_runtime_data (vnm, hw_if_index);\n  vnet_hw_if_unregister_all_rx_queues (vnm, hw_if_index);\n  vnet_hw_if_unregister_all_tx_queues (vnm, hw_if_index);\n````\n?",
      "parentUuid": "95151f9b_256ddcf9",
      "revId": "bae3444755dcdbe3cbb5fb8ef72389129d91f1e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    }
  ]
}