{
  "comments": [
    {
      "key": {
        "uuid": "7ee8daa6_a913b631",
        "filename": "src/plugins/dpdk/device/node.c",
        "patchSetId": 1
      },
      "lineNbr": 410,
      "author": {
        "id": 9
      },
      "writtenOn": "2018-03-10T11:15:39Z",
      "side": 1,
      "message": "this will generate 4 branch instructions unnecessarily.\nIf first check fails, there is no reason to do it 3 time more...\n\ni.e.\n\n if (n_trace)\n  { \n     // process 1st\n     if (n_trace)\n      {\n        // process 2nd\n     }\n     if (n_trace)\n      {\n        // process 3rd\n     }\n     if (n_trace)\n      {\n        // process 4th\n     }\n   }\n\nSomething similar I did here:\nhttps://gerrit.fd.io/r/#/c/10457/33/src/plugins/avf/input.c\n\nYou can also move vlib_trace_buffer() and n_trace-- to inline function, so code\nis more readable.",
      "range": {
        "startLine": 387,
        "startChar": 0,
        "endLine": 410,
        "endChar": 6
      },
      "revId": "7fb141c3614216ef4ac870c6606786307751547d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "241783a1_8c964f11",
        "filename": "src/plugins/dpdk/device/node.c",
        "patchSetId": 1
      },
      "lineNbr": 410,
      "author": {
        "id": 11
      },
      "writtenOn": "2018-03-11T00:29:59Z",
      "side": 1,
      "message": "This function dpdk_device_input() is an inline function called by inline function dpdk_device_input_mseg() which is called by dpdk_input().  If n_trace is 0, dpdk_input() at line 589 would call the inlined functions with input n_trace set to constant 0:\n\n      if (PREDICT_TRUE(n_trace \u003d\u003d 0))\n        n_rx_packets +\u003d dpdk_device_input_mseg (dm, xd, node, thread_index, dq-\u003equeue_id, 0);\n      else\n        {\n          u32 n_tr_packets \u003d dpdk_device_input_mseg (dm, xd, node, thread_index,\n              dq-\u003equeue_id, n_trace);\n...\n\nI would expect the compiler to not generate any code for the \"if (n_trace)\" dead path for the inlined funtcion when input parameter n_trace is constant 0. Thus, I would think the code as it is should be fine. Would you agree? Or, do you still prefer to have the 2nd to 4th \"if (n_trace)\" within the first one?",
      "parentUuid": "7ee8daa6_a913b631",
      "range": {
        "startLine": 387,
        "startChar": 0,
        "endLine": 410,
        "endChar": 6
      },
      "revId": "7fb141c3614216ef4ac870c6606786307751547d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7444474c_38204353",
        "filename": "src/plugins/dpdk/device/node.c",
        "patchSetId": 1
      },
      "lineNbr": 410,
      "author": {
        "id": 11
      },
      "writtenOn": "2018-03-11T01:13:16Z",
      "side": 1,
      "message": "I will submit a patch to fold calling of vlib_trace_buffer() into dpdk_add_trace() inline function as you suggested.",
      "parentUuid": "241783a1_8c964f11",
      "range": {
        "startLine": 387,
        "startChar": 0,
        "endLine": 410,
        "endChar": 6
      },
      "revId": "7fb141c3614216ef4ac870c6606786307751547d",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    }
  ]
}