# Download base ubuntu image
FROM ubuntu:16.04

# exact version to pin down the install with (e.g. "19.01.2-release"), or empty
ARG VPP_EXACT_VERSION

# version to check for, during the runtime. same format as above
ARG VPP_CHECK_VERSION

# packagecloud repository, e.g. "fdio/staging", "fdio/release", etc.
ARG PACKAGECLOUD_REPO

# "=19.01.2-release" for example, or empty
ENV VPP_VERSION_ARG=${VPP_EXACT_VERSION:+=${VPP_EXACT_VERSION}}
RUN export VPP_VERSION_ARG

RUN echo ${VPP_CHECK_VERSION} > /VPP_CHECK_VERSION.txt


RUN apt-get update && true
RUN apt-get upgrade -y && true
RUN apt-get install -y curl sudo gawk

# install FD.io repository
RUN (curl -s https://packagecloud.io/install/repositories/${PACKAGECLOUD_REPO}/script.deb.sh | sudo bash)

# install VPP
RUN echo " VPP exact version arg: \'${VPP_EXACT_VERSION}\'"
RUN echo " VPP version arg: \'${VPP_VERSION_ARG}\'"
RUN apt-get install -y vpp${VPP_VERSION_ARG} libvppinfra${VPP_VERSION_ARG} libvppinfra-dev${VPP_VERSION_ARG} vpp-plugin-core${VPP_VERSION_ARG} vpp-plugin-dpdk${VPP_VERSION_ARG} vpp-api-python${VPP_VERSION_ARG} python3-vpp-api${VPP_VERSION_ARG} vpp-dbg${VPP_VERSION_ARG} vpp-dev${VPP_VERSION_ARG} 

# start and test
COPY start.sh /start.sh
COPY vpp-commands.txt /vpp-commands.txt

CMD ["./start.sh"]

