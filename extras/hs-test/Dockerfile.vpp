ARG UBUNTU_VERSION=22.04

FROM ubuntu:${UBUNTU_VERSION}

ENV DIR=vpp-data/lib/vpp_plugins
COPY --from=hs-test/buildall \
   $DIR/af_packet_plugin.so \
   $DIR/hs_apps_plugin.so \
   $DIR/http_plugin.so \
   $DIR/unittest_plugin.so \
   $DIR/quic_plugin.so \
   /usr/lib/x86_64-linux-gnu/vpp_plugins/

COPY --from=hs-test/buildall vpp-data/bin/* /usr/bin/
COPY --from=hs-test/buildall vpp-data/lib/* /usr/lib/

COPY --from=hs-test/buildall /hs-test/hs-test /usr/local/bin/hs-test

RUN apt-get update
RUN DEBIAN_FRONTEND=noninteractive apt-get install -y \
    openssl libapr1 libnuma1 libsubunit0 \
    iproute2 libnl-3-dev libnl-route-3-dev iputils-ping  \
    vim gdb
RUN rm -rf /var/lib/apt/lists/*

RUN addgroup vpp

ENTRYPOINT ["tail", "-f", "/dev/null"]
