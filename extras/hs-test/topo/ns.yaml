---
devices:
  - name: "client"
    type: "netns"

  - name: "server"
    type: "netns"

  - name: "vpp0"
    type: "veth"
    peer:
      name: "client"
      netns: "client"
      ip4: "10.0.0.1/24"

  - name: "vpp1"
    type: "veth"
    peer:
      name: "server"
      netns: "server"
      ip4: "10.0.1.1/24"

volumes:
  - shared-vol

# $HST_DIR will be replaced during runtime by path to hs-test directory
containers:
  - name: "vpp"
    volumes:
      - host-dir: "shared-vol"
        container-dir: "/tmp/vpp"
        is-default-work-dir: true
  - name: "envoy"
    volumes:
      - host-dir: "$HST_DIR/envoy/proxy.yaml"
        container-dir: "/etc/envoy/envoy.yaml"
      - host-dir: "shared-vol"
        container-dir: "/tmp/vpp-envoy"
        is-default-work-dir: true
      - host-dir: "$HST_DIR/envoy"
        container-dir: "/tmp"
    vars:
      - name: "ENVOY_UID"
        value: "0"
      - name: "VCL_CONFIG"
        value: "/tmp/vcl.conf"
    image: "envoyproxy/envoy-contrib:v1.21-latest"
    is-optional: true
