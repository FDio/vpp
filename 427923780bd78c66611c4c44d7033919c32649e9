{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "eff3e461_94f9c4b1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 267
      },
      "writtenOn": "2022-10-13T23:49:59Z",
      "side": 1,
      "message": "a better way to achieve this is to register with VNET_SW_INTERFACE_ADD_DEL_FUNCTION add delete the policers state when the interface is deleted.",
      "revId": "427923780bd78c66611c4c44d7033919c32649e9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9371d0e8_42ff9d5b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 2841
      },
      "writtenOn": "2022-10-14T01:39:20Z",
      "side": 1,
      "message": "Thanks for your review and guidance!\n\nI will study and try the way.",
      "parentUuid": "eff3e461_94f9c4b1",
      "revId": "427923780bd78c66611c4c44d7033919c32649e9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "11290227_fdc32b06",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 2841
      },
      "writtenOn": "2022-10-20T15:21:19Z",
      "side": 1,
      "message": "Hi Neale,\n\nI have study the VNET_SW_INTERFACE_ADD_DEL_FUNCTION and the relations among interface、policer、classify table、classify policer、classify session. It’s indeed needed to add VNET_SW_INTERFACE_ADD_DEL_FUNCTION to delete policer classify under the interface when delete interface. Furthermore, there are other some bugs or fixes about the relations among interface、policer、classify table、classify policer、classify session or themselves. I cloud fix them one by one in the future.\n\nThe scene and problem fixed by this patch is:\nstep 1: work thread 1 processes a packet in function nat44_worker_handoff_fn_inline, the policer classify used not yet deleted at the moment, the count or use about vnet_buffer2 (b[0])-\u003enat.arc_next \u003d arc_next0 will take into account node ip4-policer-classify.\nstep 2: the work thread 2 handoff processes the above packet in step 1, if at this very moment the policer classify used in step 1 has been deleted, ip4-policer-classify will use an invalid table_index0 which is ~0, and will raise crash at pool_elt_at_index (vcm-\u003etables, table_index0).\nThis patch fix the problem by isolating the policer classify delete state and table_index used by the packet. With this patch, under the above scene, the packet will be processed normally without any crash.\n\nIs this patch a proper fix? Hope to get any further ideas or suggestions from you.",
      "parentUuid": "9371d0e8_42ff9d5b",
      "revId": "427923780bd78c66611c4c44d7033919c32649e9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6b29d18a_74104b28",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 7
      },
      "writtenOn": "2022-11-05T11:44:37Z",
      "side": 1,
      "message": "Please consider using a vppinfra bitmap to solve this problem: \n\n/** Sets the ith bit of a bitmap to new_value\n    Removes trailing zeros from the bitmap\n    @param ai - pointer to the bitmap\n    @param i - the bit position to interrogate\n    @param value - new value for the bit\n    @returns the (possibly reallocated) bitmap object pointer\n*/\nalways_inline uword *\nclib_bitmap_set (uword * ai, uword i, uword value)\n\nand\n\n/** Gets the ith bit value from a bitmap\n    @param ai - pointer to the bitmap\n    @param i - the bit position to interrogate\n    @returns the indicated bit value\n*/\nalways_inline uword\nclib_bitmap_get (uword * ai, uword i)\n\n",
      "revId": "427923780bd78c66611c4c44d7033919c32649e9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8497ed31_e64f42bd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 2841
      },
      "writtenOn": "2022-11-06T06:09:50Z",
      "side": 1,
      "message": "Ok, that\u0027s done. What about the current version？",
      "parentUuid": "6b29d18a_74104b28",
      "revId": "427923780bd78c66611c4c44d7033919c32649e9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fefb524a_2bb7df96",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 2841
      },
      "writtenOn": "2022-11-13T03:36:01Z",
      "side": 1,
      "message": "extra work need to do",
      "parentUuid": "8497ed31_e64f42bd",
      "revId": "427923780bd78c66611c4c44d7033919c32649e9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    }
  ]
}