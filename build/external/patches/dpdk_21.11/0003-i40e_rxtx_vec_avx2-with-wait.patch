commit b1179a2b9d8f7242d52d7a4bacfdfaf5dbc352bc
Author: Vratko Polak <vrpolak@cisco.com>
Date:   Wed Feb 23 18:28:49 2022 +0100

    WiP
    
    Signed-off-by: Vratko Polak <vrpolak@cisco.com>
---
 drivers/net/i40e/i40e_rxtx_vec_avx2.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/net/i40e/i40e_rxtx_vec_avx2.c b/drivers/net/i40e/i40e_rxtx_vec_avx2.c
index c73b2a321b..289336e325 100644
--- a/drivers/net/i40e/i40e_rxtx_vec_avx2.c
+++ b/drivers/net/i40e/i40e_rxtx_vec_avx2.c
@@ -633,6 +633,11 @@ uint16_t
 i40e_recv_pkts_vec_avx2(void *rx_queue, struct rte_mbuf **rx_pkts,
 		   uint16_t nb_pkts)
 {
+	uint16_t nb_bufs = _recv_raw_pkts_vec_avx2(rx_queue, rx_pkts, nb_pkts, NULL);
+	if (nb_bufs > 0)
+		return nb_bufs
+	/* Bug 487 workaround: Give hardware some time and retry once. */
+	for (int i = 0; i < 100; i++) nb_bufs += nb_pkts;
 	return _recv_raw_pkts_vec_avx2(rx_queue, rx_pkts, nb_pkts, NULL);
 }
 
