{
  "comments": [
    {
      "key": {
        "uuid": "872a6c0e_3cb3678f",
        "filename": "src/plugins/dpdk/device/init.c",
        "patchSetId": 5
      },
      "lineNbr": 348,
      "author": {
        "id": 193
      },
      "writtenOn": "2020-08-26T01:42:19Z",
      "side": 1,
      "message": "If the nic has the capability, shouldn\u0027t we be adding the VNET_BUFFER_F_L4_CHECKSUM_COMPUTED | VNET_BUFFER_F_L4_CHECKSUM_CORRECT back to the template(see line 230 [1])? The new logic you\u0027ve added will then clear the correct flag if the nic reports the a bad checksum.\n\n[1] https://gerrit.fd.io/r/c/vpp/+/26480/5/src/plugins/dpdk/device/init.c#230",
      "range": {
        "startLine": 348,
        "startChar": 3,
        "endLine": 348,
        "endChar": 44
      },
      "revId": "b6302b6e1e16cb1b6cfd98f97bc9941a423a6fc5",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1c85e52b_e0106e10",
        "filename": "src/plugins/dpdk/device/init.c",
        "patchSetId": 5
      },
      "lineNbr": 348,
      "author": {
        "id": 1692
      },
      "writtenOn": "2020-08-26T05:45:12Z",
      "side": 1,
      "message": "Hi Florin,\n\nYes, you are right. I have another patch to fix this issue, I\u0027ll add you as reviewer.\nI think the correct logic should be:\n\n0. set the default VNET_BUFFER_F_L4_CHECKSUM_COMPUTED | VNET_BUFFER_F_L4_CHECKSUM_CORRECT flags in template if enable_tcp_udp_checksum is enabled.\n\n1. If the NIC reports the pkt as good, then we do nothing(as the flags are already set)\n\n2. If the NIC reports the pkt as bad, then we only set the flag VNET_BUFFER_F_L4_CHECKSUM_COMPUTED(clear the VNET_BUFFER_F_L4_CHECKSUM_CORRECT flag).\n\n3. In both cases 2 \u0026 3, VPP does not need to calculate the checksum again. Please see the logic in ip4_local_check_l4_csum(). \n\n4. If we don\u0027t enable enable_tcp_udp_checksum, then clear flags VNET_BUFFER_F_L4_CHECKSUM_COMPUTED and VNET_BUFFER_F_L4_CHECKSUM_CORRECT in the template, and let the software to check the L4 checksum. See logic in ip4_local_l4_csum_validate().\n\n5. I think line #230 is doing the opposite - it clears the flags in template when \u0027enable_tcp_udp_checksum\u0027 is enabled.\n   Earlier I asked this question in the community but didn\u0027t get a clear feedback. I prepared a separate patch to fix this bug.",
      "parentUuid": "872a6c0e_3cb3678f",
      "range": {
        "startLine": 348,
        "startChar": 3,
        "endLine": 348,
        "endChar": 44
      },
      "revId": "b6302b6e1e16cb1b6cfd98f97bc9941a423a6fc5",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    }
  ]
}